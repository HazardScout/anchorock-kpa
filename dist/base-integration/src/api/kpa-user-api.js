"use strict";
var __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, state, kind, f) {
    if (kind === "a" && !f) throw new TypeError("Private accessor was defined without a getter");
    if (typeof state === "function" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError("Cannot read private member from an object whose class did not declare it");
    return kind === "m" ? f : kind === "a" ? f.call(receiver) : f ? f.value : state.get(receiver);
};
var _KPAUserAPI_instances, _KPAUserAPI_sendDataToKPA;
Object.defineProperty(exports, "__esModule", { value: true });
exports.KPAUserAPI = void 0;
const axios_1 = require("axios");
const model_1 = require("../model");
const utilities_1 = require("../utilities");
class KPAUserAPI {
    constructor(token) {
        _KPAUserAPI_instances.add(this);
        this.token = token;
        this.apiInstance = axios_1.default.create({ baseURL: 'https://api.kpaehs.com/v1' });
    }
    async getAllUser() {
        let result = [];
        const { data } = await this.apiInstance.post('users.list', { token: this.token });
        for (var userData of data.users) {
            let user = Object.assign(new model_1.KPAUserModel(), userData);
            result.push(user);
        }
        return result;
    }
    async saveUser(site, models) {
        var clearRecords = [];
        var duplicateRecords = [];
        for (var model of models) {
            var isDuplicate = false;
            for (let i = 0; i < clearRecords.length; i++) {
                var clearRecord = clearRecords[i];
                if (clearRecord.username === model.username || clearRecord.email === model.email || clearRecord.employeeNumber === model.employeeNumber) {
                    isDuplicate = true;
                    duplicateRecords.push(model);
                    duplicateRecords.push(clearRecord);
                    clearRecords.splice(i, 1);
                    break;
                }
            }
            if (!isDuplicate) {
                for (var duplicateRecord of duplicateRecords) {
                    if (duplicateRecord.username === model.username || duplicateRecord.email === model.email || duplicateRecord.employeeNumber === model.employeeNumber) {
                        isDuplicate = true;
                        duplicateRecords.push(model);
                        break;
                    }
                }
            }
            if (!isDuplicate) {
                clearRecords.push(model);
            }
        }
        if (clearRecords.length > 0) {
            await __classPrivateFieldGet(this, _KPAUserAPI_instances, "m", _KPAUserAPI_sendDataToKPA).call(this, site, clearRecords);
        }
        if (duplicateRecords.length > 0) {
            await __classPrivateFieldGet(this, _KPAUserAPI_instances, "m", _KPAUserAPI_sendDataToKPA).call(this, site, duplicateRecords);
        }
        return true;
    }
}
exports.KPAUserAPI = KPAUserAPI;
_KPAUserAPI_instances = new WeakSet(), _KPAUserAPI_sendDataToKPA = async function _KPAUserAPI_sendDataToKPA(site, models) {
    var _a;
    let headers = 'Site,RecordType,EmployeeNumber,FirstName,LastName,Username,InitialPassword,Role,Title,Email,TerminationDate,ForcePasswordSelection,SendWelcomeEmail';
    var content = `${headers}`;
    for (var model of models) {
        var dataUser = `${site},Employee`;
        dataUser = `${dataUser},${utilities_1.Helper.csvContentChecker(model.employeeNumber)}`;
        dataUser = `${dataUser},${utilities_1.Helper.csvContentChecker(model.firstName)}`;
        dataUser = `${dataUser},${utilities_1.Helper.csvContentChecker(model.lastName)}`;
        dataUser = `${dataUser},${utilities_1.Helper.csvContentChecker(model.username)}`;
        dataUser = `${dataUser},${utilities_1.Helper.csvContentChecker(model.initialPassword)}`;
        dataUser = `${dataUser},${utilities_1.Helper.csvContentChecker(model.role)}`;
        dataUser = `${dataUser},${utilities_1.Helper.csvContentChecker(model.title)}`;
        dataUser = `${dataUser},${utilities_1.Helper.csvContentChecker(model.email)}`;
        dataUser = `${dataUser},${utilities_1.Helper.csvContentChecker((_a = model.terminationDate) !== null && _a !== void 0 ? _a : '')}`;
        dataUser = `${dataUser},${model.resetPassword ? 'Y' : 'N'}`;
        dataUser = `${dataUser},${model.welcomeEmail ? 'Y' : 'N'}`;
        content = `${content}\n${dataUser}`;
    }
    const fileData = Buffer.from(content, 'binary').toString('base64');
    const { data } = await this.apiInstance.post('dataload.create', {
        token: this.token,
        file: `data:text/csv;base64,${fileData}`,
        failureEmails: [],
        successEmails: []
    });
    console.log(data);
    return data.ok;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia3BhLXVzZXItYXBpLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vYmFzZS1pbnRlZ3JhdGlvbi9zcmMvYXBpL2twYS11c2VyLWFwaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSxpQ0FBcUM7QUFDckMsb0NBQXdDO0FBQ3hDLDRDQUFzQztBQUd0QyxNQUFhLFVBQVU7SUFJbkIsWUFBWSxLQUFhOztRQUNyQixJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNuQixJQUFJLENBQUMsV0FBVyxHQUFHLGVBQUssQ0FBQyxNQUFNLENBQUMsRUFBQyxPQUFPLEVBQUUsMkJBQTJCLEVBQUMsQ0FBQyxDQUFBO0lBQzNFLENBQUM7SUFFRCxLQUFLLENBQUMsVUFBVTtRQUNaLElBQUksTUFBTSxHQUFvQixFQUFFLENBQUM7UUFDakMsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLE1BQU0sSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsWUFBWSxFQUFFLEVBQUMsS0FBSyxFQUFDLElBQUksQ0FBQyxLQUFLLEVBQUMsQ0FBQyxDQUFDO1FBQy9FLEtBQUssSUFBSSxRQUFRLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQzlCLElBQUksSUFBSSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxvQkFBWSxFQUFFLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDdkQsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN0QixDQUFDO1FBQ0QsT0FBTyxNQUFNLENBQUM7SUFDbEIsQ0FBQztJQUVELEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBWSxFQUFFLE1BQXNCO1FBQy9DLElBQUksWUFBWSxHQUFvQixFQUFFLENBQUE7UUFDdEMsSUFBSSxnQkFBZ0IsR0FBb0IsRUFBRSxDQUFBO1FBRTFDLEtBQUssSUFBSSxLQUFLLElBQUksTUFBTSxFQUFFLENBQUM7WUFDdkIsSUFBSSxXQUFX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cEIsQ0FBQyxDQUFDO0lBRUgsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUVqQixPQUFPLElBQUksQ0FBQyxFQUFFLENBQUM7QUFDbkIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBheGlvcywgeyBBeGlvcyB9IGZyb20gXCJheGlvc1wiO1xuaW1wb3J0IHsgS1BBVXNlck1vZGVsIH0gZnJvbSBcIi4uL21vZGVsXCI7XG5pbXBvcnQgeyBIZWxwZXIgfSBmcm9tIFwiLi4vdXRpbGl0aWVzXCI7XG5pbXBvcnQgeyBjbGVhciB9IGZyb20gXCJjb25zb2xlXCI7XG5cbmV4cG9ydCBjbGFzcyBLUEFVc2VyQVBJIHtcbiAgICB0b2tlbjogc3RyaW5nO1xuICAgIGFwaUluc3RhbmNlOiBBeGlvcztcblxuICAgIGNvbnN0cnVjdG9yKHRva2VuOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy50b2tlbiA9IHRva2VuO1xuICAgICAgICB0aGlzLmFwaUluc3RhbmNlID0gYXhpb3MuY3JlYXRlKHtiYXNlVVJMOiAnaHR0cHM6Ly9hcGkua3BhZWhzLmNvbS92MSd9KVxuICAgIH1cblxuICAgIGFzeW5jIGdldEFsbFVzZXIoKTpQcm9taXNlPEtQQVVzZXJNb2RlbFtdPiB7XG4gICAgICAgIGxldCByZXN1bHQgOiBLUEFVc2VyTW9kZWxbXSA9IFtdO1xuICAgICAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHRoaXMuYXBpSW5zdGFuY2UucG9zdCgndXNlcnMubGlzdCcsIHt0b2tlbjp0aGlzLnRva2VufSk7XG4gICAgICAgIGZvciAodmFyIHVzZXJEYXRhIG9mIGRhdGEudXNlcnMpIHtcbiAgICAgICAgICAgIGxldCB1c2VyID0gT2JqZWN0LmFzc2lnbihuZXcgS1BBVXNlck1vZGVsKCksIHVzZXJEYXRhKTtcbiAgICAgICAgICAgIHJlc3VsdC5wdXNoKHVzZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgYXN5bmMgc2F2ZVVzZXIoc2l0ZTogc3RyaW5nLCBtb2RlbHM6IEtQQVVzZXJNb2RlbFtdKSA6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgICAgICB2YXIgY2xlYXJSZWNvcmRzIDogS1BBVXNlck1vZGVsW10gPSBbXVxuICAgICAgICB2YXIgZHVwbGljYXRlUmVjb3JkcyA6IEtQQVVzZXJNb2RlbFtdID0gW11cblxuICAgICAgICBmb3IgKHZhciBtb2RlbCBvZiBtb2RlbHMpIHtcbiAgICAgICAgICAgIHZhciBpc0R1cGxpY2F0ZSA9IGZhbHNlO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjbGVhclJlY29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgY2xlYXJSZWNvcmQgOiBLUEFVc2VyTW9kZWwgPSBjbGVhclJlY29yZHNbaV07XG4gICAgICAgICAgICAgICAgaWYgKGNsZWFyUmVjb3JkLnVzZXJuYW1lID09PSBtb2RlbC51c2VybmFtZSB8fCBjbGVhclJlY29yZC5lbWFpbCA9PT0gbW9kZWwuZW1haWwgfHwgY2xlYXJSZWNvcmQuZW1wbG95ZWVOdW1iZXIgPT09IG1vZGVsLmVtcGxveWVlTnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzRHVwbGljYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgZHVwbGljYXRlUmVjb3Jkcy5wdXNoKG1vZGVsKVxuICAgICAgICAgICAgICAgICAgICBkdXBsaWNhdGVSZWNvcmRzLnB1c2goY2xlYXJSZWNvcmQpXG4gICAgICAgICAgICAgICAgICAgIGNsZWFyUmVjb3Jkcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFpc0R1cGxpY2F0ZSkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGR1cGxpY2F0ZVJlY29yZCBvZiBkdXBsaWNhdGVSZWNvcmRzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkdXBsaWNhdGVSZWNvcmQudXNlcm5hbWUgPT09IG1vZGVsLnVzZXJuYW1lIHx8IGR1cGxpY2F0ZVJlY29yZC5lbWFpbCA9PT0gbW9kZWwuZW1haWwgfHwgZHVwbGljYXRlUmVjb3JkLmVtcGxveWVlTnVtYmVyID09PSBtb2RlbC5lbXBsb3llZU51bWJlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaXNEdXBsaWNhdGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgZHVwbGljYXRlUmVjb3Jkcy5wdXNoKG1vZGVsKVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghaXNEdXBsaWNhdGUpIHtcbiAgICAgICAgICAgICAgICBjbGVhclJlY29yZHMucHVzaChtb2RlbClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjbGVhclJlY29yZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy4jc2VuZERhdGFUb0tQQShzaXRlLCBjbGVhclJlY29yZHMpXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZHVwbGljYXRlUmVjb3Jkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLiNzZW5kRGF0YVRvS1BBKHNpdGUsIGR1cGxpY2F0ZVJlY29yZHMpXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBhc3luYyAjc2VuZERhdGFUb0tQQShzaXRlOiBzdHJpbmcsIG1vZGVsczogS1BBVXNlck1vZGVsW10pIDogUHJvbWlzZTxib29sZWFuPiB7XG5cbiAgICAgICAgbGV0IGhlYWRlcnMgPSAnU2l0ZSxSZWNvcmRUeXBlLEVtcGxveWVlTnVtYmVyLEZpcnN0TmFtZSxMYXN0TmFtZSxVc2VybmFtZSxJbml0aWFsUGFzc3dvcmQsUm9sZSxUaXRsZSxFbWFpbCxUZXJtaW5hdGlvbkRhdGUsRm9yY2VQYXNzd29yZFNlbGVjdGlvbixTZW5kV2VsY29tZUVtYWlsJztcbiAgICAgICAgdmFyIGNvbnRlbnQgPSBgJHtoZWFkZXJzfWA7XG5cbiAgICAgICAgZm9yKHZhciBtb2RlbCBvZiBtb2RlbHMpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyIGRhdGFVc2VyID0gYCR7c2l0ZX0sRW1wbG95ZWVgXG4gICAgICAgICAgICBkYXRhVXNlciA9IGAke2RhdGFVc2VyfSwke0hlbHBlci5jc3ZDb250ZW50Q2hlY2tlcihtb2RlbC5lbXBsb3llZU51bWJlcil9YFxuICAgICAgICAgICAgZGF0YVVzZXIgPSBgJHtkYXRhVXNlcn0sJHtIZWxwZXIuY3N2Q29udGVudENoZWNrZXIobW9kZWwuZmlyc3ROYW1lKX1gXG4gICAgICAgICAgICBkYXRhVXNlciA9IGAke2RhdGFVc2VyfSwke0hlbHBlci5jc3ZDb250ZW50Q2hlY2tlcihtb2RlbC5sYXN0TmFtZSl9YFxuICAgICAgICAgICAgZGF0YVVzZXIgPSBgJHtkYXRhVXNlcn0sJHtIZWxwZXIuY3N2Q29udGVudENoZWNrZXIobW9kZWwudXNlcm5hbWUpfWBcbiAgICAgICAgICAgIGRhdGFVc2VyID0gYCR7ZGF0YVVzZXJ9LCR7SGVscGVyLmNzdkNvbnRlbnRDaGVja2VyKG1vZGVsLmluaXRpYWxQYXNzd29yZCl9YFxuICAgICAgICAgICAgZGF0YVVzZXIgPSBgJHtkYXRhVXNlcn0sJHtIZWxwZXIuY3N2Q29udGVudENoZWNrZXIobW9kZWwucm9sZSl9YFxuICAgICAgICAgICAgZGF0YVVzZXIgPSBgJHtkYXRhVXNlcn0sJHtIZWxwZXIuY3N2Q29udGVudENoZWNrZXIobW9kZWwudGl0bGUpfWBcbiAgICAgICAgICAgIGRhdGFVc2VyID0gYCR7ZGF0YVVzZXJ9LCR7SGVscGVyLmNzdkNvbnRlbnRDaGVja2VyKG1vZGVsLmVtYWlsKX1gXG4gICAgICAgICAgICBkYXRhVXNlciA9IGAke2RhdGFVc2VyfSwke0hlbHBlci5jc3ZDb250ZW50Q2hlY2tlcihtb2RlbC50ZXJtaW5hdGlvbkRhdGUgPz8gJycpfWBcbiAgICAgICAgICAgIGRhdGFVc2VyID0gYCR7ZGF0YVVzZXJ9LCR7bW9kZWwucmVzZXRQYXNzd29yZCA/ICdZJzogJ04nfWBcbiAgICAgICAgICAgIGRhdGFVc2VyID0gYCR7ZGF0YVVzZXJ9LCR7bW9kZWwud2VsY29tZUVtYWlsID8gJ1knOiAnTid9YFxuXG4gICAgICAgICAgICBjb250ZW50ID0gYCR7Y29udGVudH1cXG4ke2RhdGFVc2VyfWBcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGZpbGVEYXRhID0gQnVmZmVyLmZyb20oY29udGVudCwgJ2JpbmFyeScpLnRvU3RyaW5nKCdiYXNlNjQnKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgdGhpcy5hcGlJbnN0YW5jZS5wb3N0KCdkYXRhbG9hZC5jcmVhdGUnLCB7XG4gICAgICAgICAgICB0b2tlbjp0aGlzLnRva2VuLFxuICAgICAgICAgICAgZmlsZTogYGRhdGE6dGV4dC9jc3Y7YmFzZTY0LCR7ZmlsZURhdGF9YCxcbiAgICAgICAgICAgIGZhaWx1cmVFbWFpbHM6IFtdLFxuICAgICAgICAgICAgc3VjY2Vzc0VtYWlsczogW11cbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc29sZS5sb2coZGF0YSlcblxuICAgICAgICByZXR1cm4gZGF0YS5vaztcbiAgICB9XG5cbn0iXX0=