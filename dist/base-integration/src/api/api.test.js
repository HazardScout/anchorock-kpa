"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const kpa_project_api_1 = require("./kpa-project-api");
const axios_1 = require("axios");
const globals_1 = require("@jest/globals");
require('dotenv').config();
// Mock jest and set the type
jest.mock('axios');
(0, globals_1.describe)('kpa-api-project-list-test', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });
    afterEach(() => {
        jest.restoreAllMocks();
    });
    let responseData = {
        "projects": [
            {
                "id": 12,
                "created": "1744659880548",
                "updated": "1744659880548",
                "deleted": false,
                "name": "Windrock Construction Comp.",
                "number": "389532",
                "address": "5656 Winding Rd.",
                "city": "Cincinnati",
                "state": "OH",
                "zip": "45251",
                "active": true,
                "notes": null,
                "attachments": []
            },
            {
                "id": 11,
                "created": "1744659880548",
                "updated": "1744659880548",
                "deleted": false,
                "name": "Samsung Test Lab 2",
                "number": "38199",
                "address": "250 Americana Way",
                "city": "Glendale",
                "state": "CA",
                "zip": "91210",
                "active": false,
                "notes": null,
                "attachments": []
            }
        ],
        "paging": {
            "total": 4,
            "last_page": 2
        },
        "ok": true
    };
    let responseDataPage2 = {
        "projects": [
            {
                "id": 2,
                "created": "1744659880547",
                "updated": "1744659880547",
                "deleted": false,
                "name": "Apple T14",
                "number": "28192",
                "address": "10600 N Tantau Ave",
                "city": "Cupertino",
                "state": "CA",
                "zip": "95014",
                "active": true,
                "notes": null,
                "attachments": []
            },
            {
                "id": 1,
                "created": "1744659880547",
                "updated": "1744659880547",
                "deleted": false,
                "name": "Airlift Pump Station 38",
                "number": "29101",
                "address": "33 South First St",
                "city": "San Francisco",
                "state": "CA",
                "zip": "94105",
                "active": true,
                "notes": null,
                "attachments": []
            }
        ],
        "paging": {
            "total": 4,
            "last_page": 2
        },
        "ok": true
    };
    // post axios mock for project.list
    const mockPost = jest.fn().mockImplementation((url, body) => {
        switch (body.page) {
            case 1:
                return Promise.resolve({ data: responseData });
            case 2:
                return Promise.resolve({ data: responseDataPage2 });
            default:
                return Promise.resolve({ data: responseData });
        }
    });
    // create axios mock
    axios_1.default.create.mockReturnValue({ post: mockPost });
    const kpaToken = 'empty token';
    // tests
    (0, globals_1.describe)('kpaApi', () => {
        (0, globals_1.it)('kpa-project-list-with-multi-pages', async () => {
            let kpaProjectAPI = new kpa_project_api_1.KPAProjectAPI(kpaToken);
            let kpaExistProjects = await kpaProjectAPI.getAllProject();
            // assert
            (0, globals_1.expect)(axios_1.default.create).toHaveBeenCalledTimes(1);
            (0, globals_1.expect)(mockPost).toHaveBeenCalledTimes(2);
            (0, globals_1.expect)(mockPost).toHaveBeenCalledWith('projects.list', { "limit": 500, "page": 1, "token": kpaToken });
            (0, globals_1.expect)(kpaExistProjects).toBeInstanceOf(Array);
            (0, globals_1.expect)(kpaExistProjects).toHaveLength(4);
            // assert for number and code
            (0, globals_1.expect)(kpaExistProjects[0].number).not.toBeNull();
            (0, globals_1.expect)(kpaExistProjects[0].number).toBe("389532");
            (0, globals_1.expect)(kpaExistProjects[0].code).toBeDefined();
            (0, globals_1.expect)(kpaExistProjects[0].code).toBe("");
            // assert active
            (0, globals_1.expect)(kpaExistProjects[0].active).toBeTruthy();
            (0, globals_1.expect)(kpaExistProjects[1].active).toBeFalsy();
            // assert isActive is always true (used by integration)
            (0, globals_1.expect)(kpaExistProjects[0].isActive).toBeTruthy();
            (0, globals_1.expect)(kpaExistProjects[1].isActive).toBeTruthy();
            // test second page
            (0, globals_1.expect)(kpaExistProjects[2].id).toBe(2);
            (0, globals_1.expect)(kpaExistProjects[3].id).toBe(1);
        }, 300000);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9iYXNlLWludGVncmF0aW9uL3NyYy9hcGkvYXBpLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx1REFBa0Q7QUFDbEQsaUNBQTBCO0FBQzFCLDJDQUl1QjtBQUV2QixPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDM0IsNkJBQTZCO0FBQzdCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7QUFFbkIsSUFBQSxrQkFBUSxFQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtJQUN6QyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUN6QixDQUFDLENBQUMsQ0FBQztJQUVILElBQUksWUFBWSxHQUFHO1FBQ2pCLFVBQVUsRUFBRTtZQUNWO2dCQUNFLElBQUksRUFBRSxFQUFFO2dCQUNSLFNBQVMsRUFBRSxlQUFlO2dCQUMxQixTQUFTLEVBQUUsZUFBZTtnQkFDMUIsU0FBUyxFQUFFLEtBQUs7Z0JBQ2hCLE1BQU0sRUFBRSw2QkFBNkI7Z0JBQ3JDLFFBQVEsRUFBRSxRQUFRO2dCQUNsQixTQUFTLEVBQUUsa0JBQWtCO2dCQUM3QixNQUFNLEVBQUUsWUFBWTtnQkFDcEIsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsS0FBSyxFQUFFLE9BQU87Z0JBQ2QsUUFBUSxFQUFFLElBQUk7Z0JBQ2QsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsYUFBYSxFQUFFLEVBQUU7YUFDbEI7WUFDRDtnQkFDRSxJQUFJLEVBQUUsRUFBRTtnQkFDUixTQUFTLEVBQUUsZUFBZTtnQkFDMUIsU0FBUyxFQUFFLGVBQWU7Z0JBQzFCLFNBQVMsRUFBRSxLQUFLO2dCQUNo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LElBQUEsZ0JBQU0sRUFBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUNsRCxJQUFBLGdCQUFNLEVBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7WUFFbEQsbUJBQW1CO1lBQ25CLElBQUEsZ0JBQU0sRUFBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkMsSUFBQSxnQkFBTSxFQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QyxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFFYixDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgS1BBUHJvamVjdEFQSSB9IGZyb20gJy4va3BhLXByb2plY3QtYXBpJztcbmltcG9ydCBheGlvcyBmcm9tIFwiYXhpb3NcIjtcbmltcG9ydCB7XG4gIGRlc2NyaWJlLFxuICBpdCxcbiAgZXhwZWN0LFxufSBmcm9tICdAamVzdC9nbG9iYWxzJztcblxucmVxdWlyZSgnZG90ZW52JykuY29uZmlnKCk7XG4vLyBNb2NrIGplc3QgYW5kIHNldCB0aGUgdHlwZVxuamVzdC5tb2NrKCdheGlvcycpO1xuXG5kZXNjcmliZSgna3BhLWFwaS1wcm9qZWN0LWxpc3QtdGVzdCcsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgbGV0IHJlc3BvbnNlRGF0YSA9IHtcbiAgICBcInByb2plY3RzXCI6IFtcbiAgICAgIHtcbiAgICAgICAgXCJpZFwiOiAxMixcbiAgICAgICAgXCJjcmVhdGVkXCI6IFwiMTc0NDY1OTg4MDU0OFwiLFxuICAgICAgICBcInVwZGF0ZWRcIjogXCIxNzQ0NjU5ODgwNTQ4XCIsXG4gICAgICAgIFwiZGVsZXRlZFwiOiBmYWxzZSxcbiAgICAgICAgXCJuYW1lXCI6IFwiV2luZHJvY2sgQ29uc3RydWN0aW9uIENvbXAuXCIsXG4gICAgICAgIFwibnVtYmVyXCI6IFwiMzg5NTMyXCIsXG4gICAgICAgIFwiYWRkcmVzc1wiOiBcIjU2NTYgV2luZGluZyBSZC5cIixcbiAgICAgICAgXCJjaXR5XCI6IFwiQ2luY2lubmF0aVwiLFxuICAgICAgICBcInN0YXRlXCI6IFwiT0hcIixcbiAgICAgICAgXCJ6aXBcIjogXCI0NTI1MVwiLFxuICAgICAgICBcImFjdGl2ZVwiOiB0cnVlLFxuICAgICAgICBcIm5vdGVzXCI6IG51bGwsXG4gICAgICAgIFwiYXR0YWNobWVudHNcIjogW11cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIFwiaWRcIjogMTEsXG4gICAgICAgIFwiY3JlYXRlZFwiOiBcIjE3NDQ2NTk4ODA1NDhcIixcbiAgICAgICAgXCJ1cGRhdGVkXCI6IFwiMTc0NDY1OTg4MDU0OFwiLFxuICAgICAgICBcImRlbGV0ZWRcIjogZmFsc2UsXG4gICAgICAgIFwibmFtZVwiOiBcIlNhbXN1bmcgVGVzdCBMYWIgMlwiLFxuICAgICAgICBcIm51bWJlclwiOiBcIjM4MTk5XCIsXG4gICAgICAgIFwiYWRkcmVzc1wiOiBcIjI1MCBBbWVyaWNhbmEgV2F5XCIsXG4gICAgICAgIFwiY2l0eVwiOiBcIkdsZW5kYWxlXCIsXG4gICAgICAgIFwic3RhdGVcIjogXCJDQVwiLFxuICAgICAgICBcInppcFwiOiBcIjkxMjEwXCIsXG4gICAgICAgIFwiYWN0aXZlXCI6IGZhbHNlLFxuICAgICAgICBcIm5vdGVzXCI6IG51bGwsXG4gICAgICAgIFwiYXR0YWNobWVudHNcIjogW11cbiAgICAgIH1dLFxuICAgICAgXCJwYWdpbmdcIjoge1xuICAgICAgICAgIFwidG90YWxcIjogNCxcbiAgICAgICAgICBcImxhc3RfcGFnZVwiOiAyXG4gICAgICB9LFxuICAgICAgXCJva1wiOiB0cnVlXG4gIH07XG5cbiAgbGV0IHJlc3BvbnNlRGF0YVBhZ2UyID0ge1xuICAgIFwicHJvamVjdHNcIjogW1xuICAgICAge1xuICAgICAgICBcImlkXCI6IDIsXG4gICAgICAgIFwiY3JlYXRlZFwiOiBcIjE3NDQ2NTk4ODA1NDdcIixcbiAgICAgICAgXCJ1cGRhdGVkXCI6IFwiMTc0NDY1OTg4MDU0N1wiLFxuICAgICAgICBcImRlbGV0ZWRcIjogZmFsc2UsXG4gICAgICAgIFwibmFtZVwiOiBcIkFwcGxlIFQxNFwiLFxuICAgICAgICBcIm51bWJlclwiOiBcIjI4MTkyXCIsXG4gICAgICAgIFwiYWRkcmVzc1wiOiBcIjEwNjAwIE4gVGFudGF1IEF2ZVwiLFxuICAgICAgICBcImNpdHlcIjogXCJDdXBlcnRpbm9cIixcbiAgICAgICAgXCJzdGF0ZVwiOiBcIkNBXCIsXG4gICAgICAgIFwiemlwXCI6IFwiOTUwMTRcIixcbiAgICAgICAgXCJhY3RpdmVcIjogdHJ1ZSxcbiAgICAgICAgXCJub3Rlc1wiOiBudWxsLFxuICAgICAgICBcImF0dGFjaG1lbnRzXCI6IFtdXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBcImlkXCI6IDEsXG4gICAgICAgIFwiY3JlYXRlZFwiOiBcIjE3NDQ2NTk4ODA1NDdcIixcbiAgICAgICAgXCJ1cGRhdGVkXCI6IFwiMTc0NDY1OTg4MDU0N1wiLFxuICAgICAgICBcImRlbGV0ZWRcIjogZmFsc2UsXG4gICAgICAgIFwibmFtZVwiOiBcIkFpcmxpZnQgUHVtcCBTdGF0aW9uIDM4XCIsXG4gICAgICAgIFwibnVtYmVyXCI6IFwiMjkxMDFcIixcbiAgICAgICAgXCJhZGRyZXNzXCI6IFwiMzMgU291dGggRmlyc3QgU3RcIixcbiAgICAgICAgXCJjaXR5XCI6IFwiU2FuIEZyYW5jaXNjb1wiLFxuICAgICAgICBcInN0YXRlXCI6IFwiQ0FcIixcbiAgICAgICAgXCJ6aXBcIjogXCI5NDEwNVwiLFxuICAgICAgICBcImFjdGl2ZVwiOiB0cnVlLFxuICAgICAgICBcIm5vdGVzXCI6IG51bGwsXG4gICAgICAgIFwiYXR0YWNobWVudHNcIjogW11cbiAgICAgIH1dLFxuICAgICAgXCJwYWdpbmdcIjoge1xuICAgICAgICAgIFwidG90YWxcIjogNCxcbiAgICAgICAgICBcImxhc3RfcGFnZVwiOiAyXG4gICAgICB9LFxuICAgICAgXCJva1wiOiB0cnVlXG4gIH07XG4gIC8vIHBvc3QgYXhpb3MgbW9jayBmb3IgcHJvamVjdC5saXN0XG4gIGNvbnN0IG1vY2tQb3N0ID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigodXJsLCBib2R5KSA9PiB7XG4gICAgc3dpdGNoIChib2R5LnBhZ2UpIHtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7ZGF0YTogcmVzcG9uc2VEYXRhfSlcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7ZGF0YTogcmVzcG9uc2VEYXRhUGFnZTJ9KVxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7ZGF0YTogcmVzcG9uc2VEYXRhfSlcbiAgICB9XG4gIH0pO1xuICAvLyBjcmVhdGUgYXhpb3MgbW9ja1xuICAoYXhpb3MuY3JlYXRlIGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKHsgcG9zdDogbW9ja1Bvc3QgfSk7XG4gIGNvbnN0IGtwYVRva2VuID0gJ2VtcHR5IHRva2VuJztcblxuICAvLyB0ZXN0c1xuICBkZXNjcmliZSgna3BhQXBpJywgKCkgPT4ge1xuXG4gICAgaXQoJ2twYS1wcm9qZWN0LWxpc3Qtd2l0aC1tdWx0aS1wYWdlcycsIGFzeW5jICgpID0+IHtcblxuICAgICAgbGV0IGtwYVByb2plY3RBUEkgPSBuZXcgS1BBUHJvamVjdEFQSShrcGFUb2tlbik7XG4gICAgICBsZXQga3BhRXhpc3RQcm9qZWN0cyA9IGF3YWl0IGtwYVByb2plY3RBUEkuZ2V0QWxsUHJvamVjdCgpO1xuICAgICAgLy8gYXNzZXJ0XG4gICAgICBleHBlY3QoYXhpb3MuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICBleHBlY3QobW9ja1Bvc3QpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICAgIGV4cGVjdChtb2NrUG9zdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3Byb2plY3RzLmxpc3QnLCB7XCJsaW1pdFwiOiA1MDAsIFwicGFnZVwiOiAxLCBcInRva2VuXCI6IGtwYVRva2VufSk7XG4gICAgICBleHBlY3Qoa3BhRXhpc3RQcm9qZWN0cykudG9CZUluc3RhbmNlT2YoQXJyYXkpO1xuICAgICAgZXhwZWN0KGtwYUV4aXN0UHJvamVjdHMpLnRvSGF2ZUxlbmd0aCg0KTtcblxuICAgICAgLy8gYXNzZXJ0IGZvciBudW1iZXIgYW5kIGNvZGVcbiAgICAgIGV4cGVjdChrcGFFeGlzdFByb2plY3RzWzBdLm51bWJlcikubm90LnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3Qoa3BhRXhpc3RQcm9qZWN0c1swXS5udW1iZXIpLnRvQmUoXCIzODk1MzJcIik7XG4gICAgICBleHBlY3Qoa3BhRXhpc3RQcm9qZWN0c1swXS5jb2RlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGtwYUV4aXN0UHJvamVjdHNbMF0uY29kZSkudG9CZShcIlwiKTtcblxuICAgICAgLy8gYXNzZXJ0IGFjdGl2ZVxuICAgICAgZXhwZWN0KGtwYUV4aXN0UHJvamVjdHNbMF0uYWN0aXZlKS50b0JlVHJ1dGh5KCk7XG4gICAgICBleHBlY3Qoa3BhRXhpc3RQcm9qZWN0c1sxXS5hY3RpdmUpLnRvQmVGYWxzeSgpO1xuXG4gICAgICAvLyBhc3NlcnQgaXNBY3RpdmUgaXMgYWx3YXlzIHRydWUgKHVzZWQgYnkgaW50ZWdyYXRpb24pXG4gICAgICBleHBlY3Qoa3BhRXhpc3RQcm9qZWN0c1swXS5pc0FjdGl2ZSkudG9CZVRydXRoeSgpO1xuICAgICAgZXhwZWN0KGtwYUV4aXN0UHJvamVjdHNbMV0uaXNBY3RpdmUpLnRvQmVUcnV0aHkoKTtcblxuICAgICAgLy8gdGVzdCBzZWNvbmQgcGFnZVxuICAgICAgZXhwZWN0KGtwYUV4aXN0UHJvamVjdHNbMl0uaWQpLnRvQmUoMik7XG4gICAgICBleHBlY3Qoa3BhRXhpc3RQcm9qZWN0c1szXS5pZCkudG9CZSgxKTtcbiAgICB9LCAzMDAwMDApO1xuXG4gIH0pXG59KVxuIl19